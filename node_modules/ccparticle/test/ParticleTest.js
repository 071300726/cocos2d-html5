/**
 * Created by Huabin LING on 12/31/13.
 */

var ParticleTest = cc.LayerGradient.extend({
    _emitter:null,
    _background:null,
    _startx:0,
    _offset:300,
    _duration:4,
    _reverse:false,
    _backy:0,

    ctor:function () {
        this._super();
        this.init(cc.c4b(0,0,0,255), cc.c4b(98,99,117,255));

        this._emitter = null;

        var s = cc.Director.getInstance().getWinSize();
        // Start position of background
        this._startx = s.width / 2 - 150;
        this._backy = s.height - 180;

        // Add emitter to background to show movement with particle
        this._background = cc.Sprite.create(res.background3_png);
        this.addChild(this._background, 5);
        this._background.setPosition(this._startx, this._backy);
    },

    update:function(dt) {
        // Background movement
        var currx = this._background.getPosition().x;
        if(this._reverse) {
            currx -= this._offset * dt / this._duration;

            if(currx < this._startx)
                this._reverse = false;
        }
        else {
            currx += this._offset * dt / this._duration;

            if(currx > this._startx + this._offset)
                this._reverse = true;
        }

        this._background.setPosition(currx, this._backy);
    },

    setEmitterPosition:function () {
        var sourcePos = this._emitter.getSourcePosition();
        if (sourcePos.x === 0 && sourcePos.y === 0)
            this._emitter.setPosition(200, 70);
    }
});





// CCImage Dependency

/**
 * Image Format:PNG
 * @constant
 * @type Number
 */
cc.FMT_PNG = 1;

/**
 * Image Format:TIFF
 * @constant
 * @type Number
 */
cc.FMT_TIFF = 2;

cc.getImageFormatByData = function (imgData) {
    // if it is a png file buffer.
    if (imgData.length > 8) {
        if (imgData[0] == 0x89
            && imgData[1] == 0x50
            && imgData[2] == 0x4E
            && imgData[3] == 0x47
            && imgData[4] == 0x0D
            && imgData[5] == 0x0A
            && imgData[6] == 0x1A
            && imgData[7] == 0x0A) {
            return cc.FMT_PNG;
        }
    }

    // if it is a tiff file buffer.
    if (imgData.length > 2) {
        if ((imgData[0] == 0x49 && imgData[1] == 0x49)
            || (imgData[0] == 0x4d && imgData[1] == 0x4d)
            || (imgData[0] == 0xff && imgData[1] == 0xd8)) {
            return cc.FMT_TIFF;
        }
    }

    return cc.FMT_UNKNOWN;
};